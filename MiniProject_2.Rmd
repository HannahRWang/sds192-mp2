---
title: "Mini-Project 2"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r}
contributions_alt <- contributions %>%
  filter(transaction_type == "24E", 
         transaction_pgi == "G2012")%>%
  select(cmte_id, transaction_type, entity_type, transaction_pgi, name, state, transaction_amt, cand_id, file_num)
  
```

```{r}
candidates_alt <- candidates %>%
  filter(cand_election_yr == "2012", cand_office == "P")
```

```{r}
joined_table <- contributions_alt %>%
  full_join(candidates_alt, by = "cand_id") %>%
  filter(entity_type == "IND", state == "CA") %>%
  group_by(state, cand_name) %>%
  summarize(avg_donation = mean(transaction_amt))%>%
  na.omit
```

```{r}
individual_contributions <- ggplot(joined_table, aes(x=cand_name, y=avg_donation, fill = cand_name))+
  geom_col()+
  geom_text(aes(label=round(avg_donation, digits = 2)))+
  facet_wrap(~state, scales='free_x', ncol = 5)+
  xlab("Candidate Name")+
  ylab("Average Donation")+
  theme(legend.position = "none")+
  scale_fill_manual(values = c("blue","red"))+
  theme(axis.text.x = element_text(size=5),
        axis.text.y = element_text(size=5))+
  labs(title = "Average Individual Presidential Candidate Donation By State")

individual_contributions
```

```{r}
functionname <- function(name_arg) {
  contributions_alt %>%
  full_join(candidates_alt, by = "cand_id") %>%
  filter(entity_type == name_arg, state == "CA") %>%
  na.omit
}
```

```{r}
entity_types <- c("IND", "ORG", "CCM", "COM")
```


```{r}
mapped_function <- map(entity_types, functionname)
mapped_function <- bind_rows(mapped_function)

new_mapped_function <- mapped_function %>%
  group_by(entity_type, cand_name) %>%
  summarize(avg_donation = mean(transaction_amt))

```

```{r}
final_plot <- ggplot(new_mapped_function, aes(x=cand_name, y=avg_donation, fill = cand_name))+
  geom_col() +
  scale_fill_manual(values = c("blue","red"))+
  facet_wrap(~entity_type)+
  geom_text(aes(label=round(avg_donation, digits = 2)))


final_plot
```


^[Github Repository: https://github.com/HannahRWang/sds192-mp2]
